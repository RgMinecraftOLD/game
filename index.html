<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Mini Minecraft</title>
<style>
body { margin:0; overflow:hidden; background:#000; }
#ui {
 position:fixed;
 bottom:20px;
 left:50%;
 transform:translateX(-50%);
 color:white;
 font-family:sans-serif;
 background:rgba(0,0,0,0.5);
 padding:10px 20px;
 border-radius:10px;
}
#crosshair {
 position:fixed;
 left:50%;
 top:50%;
 transform:translate(-50%,-50%);
 color:white;
 font-size:24px;
 pointer-events:none;
}
</style>
</head>
<body>

<div id="crosshair">+</div>
<div id="ui">Тап — ломать | Два пальца — ставить | Проведи — смотреть</div>

<script type="module">
import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js";
import { PointerLockControls } from "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/controls/PointerLockControls.js";

const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer();
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

const light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(10,20,10);
scene.add(light);
scene.add(new THREE.AmbientLight(0xffffff,0.5));

const controls = new PointerLockControls(camera, document.body);
document.body.addEventListener("click", ()=>controls.lock());

camera.position.set(0,2,5);

const world = [];
const blockGeo = new THREE.BoxGeometry(1,1,1);
const blockMat = new THREE.MeshLambertMaterial({color:0x55aa55});

function addBlock(x,y,z){
 const b = new THREE.Mesh(blockGeo, blockMat);
 b.position.set(x,y,z);
 scene.add(b);
 world.push(b);
}

for(let x=-10;x<10;x++){
 for(let z=-10;z<10;z++){
   addBlock(x,0,z);
 }
}

let velocity = new THREE.Vector3();
let direction = new THREE.Vector3();
let canJump = false;

const keys = {};
onkeydown = e => keys[e.code]=true;
onkeyup = e => keys[e.code]=false;

const raycaster = new THREE.Raycaster();

function animate(){
 requestAnimationFrame(animate);

 direction.set(0,0,0);
 if(keys["KeyW"]) direction.z -= 1;
 if(keys["KeyS"]) direction.z += 1;
 if(keys["KeyA"]) direction.x -= 1;
 if(keys["KeyD"]) direction.x += 1;

 direction.normalize();

 velocity.x = direction.x * 0.1;
 velocity.z = direction.z * 0.1;
 velocity.y -= 0.01; // gravity

 controls.moveRight(velocity.x);
 controls.moveForward(velocity.z);
 camera.position.y += velocity.y;

 if(camera.position.y < 2){
   velocity.y = 0;
   camera.position.y = 2;
   canJump = true;
 }

 renderer.render(scene, camera);
}
animate();

document.addEventListener("touchstart", e=>{
 if(e.touches.length===1){
   // ломать блок
   raycaster.setFromCamera(new THREE.Vector2(0,0), camera);
   const hits = raycaster.intersectObjects(world);
   if(hits.length){
     scene.remove(hits[0].object);
     world.splice(world.indexOf(hits[0].object),1);
   }
 }
 if(e.touches.length===2){
   // ставить блок
   raycaster.setFromCamera(new THREE.Vector2(0,0), camera);
   const hits = raycaster.intersectObjects(world);
   if(hits.length){
     const p = hits[0].point.clone().add(hits[0].face.normal);
     addBlock(Math.round(p.x),Math.round(p.y),Math.round(p.z));
   }
 }
});

document.addEventListener("keydown", e=>{
 if(e.code==="Space" && canJump){
   velocity.y = 0.2;
   canJump = false;
 }
});

onresize = ()=>{
 camera.aspect = innerWidth/innerHeight;
 camera.updateProjectionMatrix();
 renderer.setSize(innerWidth, innerHeight);
};
</script>
</body>
</html>
