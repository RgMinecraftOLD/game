<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>MiniCraft Test</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
html,body{margin:0;padding:0;width:100%;height:100%;overflow:hidden;background:#87CEEB;}
canvas{width:100%;height:100%;display:block;}
#ui{position:fixed;inset:0;pointer-events:none;}
.btn{pointer-events:auto;position:absolute;width:70px;height:70px;border-radius:50%;background:rgba(0,0,0,0.45);color:#fff;font-size:28px;border:none;}
#up{left:80px;bottom:170px;}
#down{left:80px;bottom:40px;}
#left{left:10px;bottom:105px;}
#right{left:150px;bottom:105px;}
#jump{right:30px;bottom:160px;width:100px;height:100px;font-size:16px;background:rgba(50,180,50,0.8);}
</style>
</head>
<body>

<canvas id="c"></canvas>

<div id="ui">
  <button class="btn" id="up">⬆️</button>
  <button class="btn" id="down">⬇️</button>
  <button class="btn" id="left">⬅️</button>
  <button class="btn" id="right">➡️</button>
  <button class="btn" id="jump">ПРЫЖОК</button>
</div>

<script src="https://cdn.babylonjs.com/babylon.js"></script>
<script>
const canvas = document.getElementById("c");
const engine = new BABYLON.Engine(canvas, true);
const scene = new BABYLON.Scene(engine);
scene.clearColor = new BABYLON.Color3(0.53,0.8,1);
scene.gravity = new BABYLON.Vector3(0,-0.15,0);
scene.collisionsEnabled = true;

// Камера
const camera = new BABYLON.UniversalCamera("cam", new BABYLON.Vector3(0,2,-5), scene);
camera.attachControl(canvas, true);
camera.speed = 0.06;              // медленная нормальная скорость
camera.applyGravity = true;
camera.ellipsoid = new BABYLON.Vector3(0.4,0.9,0.4);
camera.checkCollisions = true;

// Чувствительность поворота пальцем
camera.angularSensibility = 5000;

// Свет
new BABYLON.HemisphericLight("l", new BABYLON.Vector3(0,1,0), scene);

// Земля
for(let x=-15;x<=15;x++){
  for(let z=-15;z<=15;z++){
    const g = BABYLON.MeshBuilder.CreateBox("g",{size:1},scene);
    g.position.set(x,-0.5,z);
    g.checkCollisions = true;
    const m = new BABYLON.StandardMaterial("gm",scene);
    m.diffuseColor = new BABYLON.Color3(0.3,0.8,0.3);
    g.material = m;
  }
}

// Блок
const box = BABYLON.MeshBuilder.CreateBox("b",{size:1},scene);
box.position.set(0,0.5,3);
box.checkCollisions = true;

// Управление кнопками
let f=0,s=0;
function bind(id,fn){
  const b=document.getElementById(id);
  b.ontouchstart=e=>{e.preventDefault();fn(1);}
  b.ontouchend=e=>{e.preventDefault();fn(0);}
}
bind("up",v=>f=v);
bind("down",v=>f=-v);
bind("left",v=>s=-v);
bind("right",v=>s=v);

// Прыжок (не высокий)
document.getElementById("jump").ontouchstart = e=>{
  e.preventDefault();
  if(Math.abs(camera.cameraDirection.y)<0.05){
    camera.cameraDirection.y = 0.32;
  }
};

engine.runRenderLoop(()=>{
  const forward = camera.getDirection(BABYLON.Axis.Z);
  const right = camera.getDirection(BABYLON.Axis.X);
  const move = forward.scale(f*0.08).add(right.scale(s*0.08));
  camera.moveWithCollisions(move);
  scene.render();
});

window.addEventListener("resize",()=>engine.resize());
</script>

</body>
</html>
