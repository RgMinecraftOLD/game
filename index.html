<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>MiniCraft</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    touch-action: none;
    background: #87CEEB;
}

#renderCanvas {
    width: 100vw;
    height: 100vh;
    touch-action: none;
}

/* Кнопки */
.button {
    position: fixed;
    width: 70px;
    height: 70px;
    border-radius: 50%;
    border: none;
    background: rgba(0,0,0,0.4);
    color: white;
    font-size: 30px;
}

#up { left: 90px; bottom: 160px; }
#down { left: 90px; bottom: 20px; }
#left { left: 20px; bottom: 90px; }
#right { left: 160px; bottom: 90px; }

#jump {
    right: 20px;
    bottom: 80px;
    width: 110px;
    height: 110px;
    background: green;
    font-size: 20px;
}
</style>
</head>

<body>

<canvas id="renderCanvas"></canvas>

<button class="button" id="up">↑</button>
<button class="button" id="down">↓</button>
<button class="button" id="left">←</button>
<button class="button" id="right">→</button>
<button class="button" id="jump">ПРЫЖОК</button>

<script src="https://cdn.babylonjs.com/babylon.js"></script>

<script>
const canvas = document.getElementById("renderCanvas");
const engine = new BABYLON.Engine(canvas, true);

const scene = new BABYLON.Scene(engine);
scene.clearColor = new BABYLON.Color3(0.53, 0.81, 0.92);

// Камера — можно крутить пальцем
const camera = new BABYLON.ArcRotateCamera(
    "cam",
    Math.PI / 2,
    Math.PI / 3,
    10,
    new BABYLON.Vector3(0,1,0),
    scene
);
camera.attachControl(canvas, true);

// Свет
new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0,1,0), scene);

// Земля
const ground = BABYLON.MeshBuilder.CreateGround("ground", {width:50, height:50}, scene);
const groundMat = new BABYLON.StandardMaterial("gmat", scene);
groundMat.diffuseColor = new BABYLON.Color3(0.2, 0.8, 0.2);
ground.material = groundMat;

// Игрок (куб)
const player = BABYLON.MeshBuilder.CreateBox("player", {size:1}, scene);
player.position.y = 0.5;

const pmat = new BABYLON.StandardMaterial("pmat", scene);
pmat.diffuseColor = new BABYLON.Color3(0.8,0.2,0.2);
player.material = pmat;

// Камера следует за игроком
camera.target = player.position;

// Физика
let velocityY = 0;
let onGround = true;

// Управление
const keys = {
    up:false, down:false, left:false, right:false
};

function bindButton(id, key) {
    const btn = document.getElementById(id);
    btn.addEventListener("touchstart", () => keys[key] = true);
    btn.addEventListener("touchend", () => keys[key] = false);
}

bindButton("up","up");
bindButton("down","down");
bindButton("left","left");
bindButton("right","right");

// Прыжок
document.getElementById("jump").addEventListener("touchstart", ()=>{
    if(onGround){
        velocityY = 0.25;
        onGround = false;
    }
});

scene.onBeforeRenderObservable.add(()=>{

    const speed = 0.1;

    if(keys.up) player.position.z += speed;
    if(keys.down) player.position.z -= speed;
    if(keys.left) player.position.x -= speed;
    if(keys.right) player.position.x += speed;

    // Гравитация
    velocityY -= 0.01;
    player.position.y += velocityY;

    if(player.position.y <= 0.5){
        player.position.y = 0.5;
        velocityY = 0;
        onGround = true;
    }

    // Камера следует
    camera.target = player.position;
});

engine.runRenderLoop(()=>{
    scene.render();
});

window.addEventListener("resize", ()=>{
    engine.resize();
});
</script>

</body>
</html>
