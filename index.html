<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Mini Minecraft iOS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
body { margin:0; overflow:hidden; background:#000; touch-action:none; }

#crosshair {
 position:fixed;
 left:50%;
 top:50%;
 transform:translate(-50%,-50%);
 color:white;
 font-size:24px;
 pointer-events:none;
 z-index:10;
}

#ui {
 position:fixed;
 bottom:10px;
 left:50%;
 transform:translateX(-50%);
 display:flex;
 gap:10px;
 z-index:20;
}

.btn {
 background:rgba(0,0,0,0.6);
 color:white;
 border:none;
 border-radius:12px;
 padding:12px 16px;
 font-size:16px;
}

#move {
 position:fixed;
 left:10px;
 bottom:10px;
 display:grid;
 grid-template-columns:60px 60px 60px;
 grid-template-rows:60px 60px 60px;
 gap:5px;
 z-index:20;
}
</style>
</head>
<body>

<div id="crosshair">+</div>

<div id="move">
  <div></div>
  <button class="btn" id="forward">‚Üë</button>
  <div></div>
  <button class="btn" id="left">‚Üê</button>
  <div></div>
  <button class="btn" id="right">‚Üí</button>
  <div></div>
  <button class="btn" id="back">‚Üì</button>
  <div></div>
</div>

<div id="ui">
  <button class="btn" id="break">üëä –õ–æ–º–∞—Ç—å</button>
  <button class="btn" id="place">üß± –°—Ç–∞–≤–∏—Ç—å</button>
  <button class="btn" id="jump">‚¨ÜÔ∏è –ü—Ä—ã–∂–æ–∫</button>
</div>

<script type="module">
import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js";

const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.DirectionalLight(0xffffff,1));
scene.add(new THREE.AmbientLight(0xffffff,0.6));

const world = [];
const geo = new THREE.BoxGeometry(1,1,1);
const mat = new THREE.MeshLambertMaterial({color:0x55aa55});

function addBlock(x,y,z){
 const b = new THREE.Mesh(geo, mat);
 b.position.set(x,y,z);
 scene.add(b);
 world.push(b);
}

for(let x=-15;x<=15;x++){
 for(let z=-15;z<=15;z++){
   addBlock(x,0,z);
 }
}

const player = {
 pos: new THREE.Vector3(0,2,5),
 velY: 0,
 onGround: false
};

let rotX = -0.3, rotY = 0;

let touching = false;
let lastX=0, lastY=0;

document.addEventListener("touchstart", e=>{
 touching=true;
 lastX=e.touches[0].clientX;
 lastY=e.touches[0].clientY;
});

document.addEventListener("touchmove", e=>{
 if(!touching) return;
 const x=e.touches[0].clientX;
 const y=e.touches[0].clientY;
 const dx=x-lastX;
 const dy=y-lastY;
 lastX=x; lastY=y;

 rotY -= dx*0.005;
 rotX -= dy*0.005;
 rotX = Math.max(-1.4, Math.min(1.4, rotX));
});

document.addEventListener("touchend", ()=>touching=false);

const keys = {f:0,b:0,l:0,r:0};

function bind(id,key){
 const el=document.getElementById(id);
 el.addEventListener("touchstart",()=>keys[key]=1);
 el.addEventListener("touchend",()=>keys[key]=0);
}

bind("forward","f");
bind("back","b");
bind("left","l");
bind("right","r");

document.getElementById("jump").onclick=()=>{
 if(player.onGround){
  player.velY=0.18;
  player.onGround=false;
 }
};

const raycaster = new THREE.Raycaster();

document.getElementById("break").onclick=()=>{
 raycaster.setFromCamera({x:0,y:0}, camera);
 const hits = raycaster.intersectObjects(world);
 if(hits.length){
  const obj = hits[0].object;
  scene.remove(obj);
  world.splice(world.indexOf(obj),1);
 }
};

document.getElementById("place").onclick=()=>{
 raycaster.setFromCamera({x:0,y:0}, camera);
 const hits = raycaster.intersectObjects(world);
 if(hits.length){
  const p = hits[0].point.clone().add(hits[0].face.normal);
  addBlock(Math.round(p.x),Math.round(p.y),Math.round(p.z));
 }
};

function animate(){
 requestAnimationFrame(animate);

 // –¥–≤–∏–∂–µ–Ω–∏–µ
 const dir = new THREE.Vector3();
 camera.getWorldDirection(dir);
 dir.y=0; dir.normalize();
 const right = new THREE.Vector3().crossVectors(dir,new THREE.Vector3(0,1,0));

 const speed=0.08;
 if(keys.f) player.pos.add(dir.clone().multiplyScalar(speed));
 if(keys.b) player.pos.add(dir.clone().multiplyScalar(-speed));
 if(keys.l) player.pos.add(right.clone().multiplyScalar(speed));
 if(keys.r) player.pos.add(right.clone().multiplyScalar(-speed));

 // –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—è
 player.velY -= 0.01;
 player.pos.y += player.velY;

 if(player.pos.y<2){
  player.pos.y=2;
  player.velY=0;
  player.onGround=true;
 }

 camera.position.copy(player.pos);
 camera.rotation.set(rotX,rotY,0);

 renderer.render(scene,camera);
}

animate();

onresize=()=>{
 camera.aspect=innerWidth/innerHeight;
 camera.updateProjectionMatrix();
 renderer.setSize(innerWidth,innerHeight);
};
</script>
</body>
</html>
