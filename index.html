<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>MiniCraft iOS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: #87CEEB;
    touch-action: none;
}

#renderCanvas {
    width: 100vw;
    height: 100vh;
    display: block;
}
.button {
    position: fixed;
    width: 70px;
    height: 70px;
    border-radius: 50%;
    background: rgba(0,0,0,0.4);
    color: white;
    font-size: 30px;
    border: none;
}
#up { left: 90px; bottom: 160px; }
#down { left: 90px; bottom: 20px; }
#left { left: 20px; bottom: 90px; }
#right { left: 160px; bottom: 90px; }

#jump {
    right: 20px;
    bottom: 80px;
    width: 110px;
    height: 110px;
    background: green;
    font-size: 20px;
}
</style>
</head>
<body>

<canvas id="renderCanvas"></canvas>

<button class="button" id="up">↑</button>
<button class="button" id="down">↓</button>
<button class="button" id="left">←</button>
<button class="button" id="right">→</button>
<button class="button" id="jump">ПРЫЖОК</button>

<script src="https://cdn.babylonjs.com/babylon.js"></script>

<script>
const canvas = document.getElementById("renderCanvas");
const engine = new BABYLON.Engine(canvas, true);

const scene = new BABYLON.Scene(engine);
scene.clearColor = new BABYLON.Color3(0.53, 0.81, 0.92);

// Camera
const camera = new BABYLON.UniversalCamera("cam",
    new BABYLON.Vector3(0, 6, -10), scene);
camera.setTarget(new BABYLON.Vector3(0,1,0));

// Light
new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0,1,0), scene);

// Green ground
const ground = BABYLON.MeshBuilder.CreateGround("g", {width:50, height:50}, scene);
const gmat = new BABYLON.StandardMaterial("gmat", scene);
gmat.diffuseColor = new BABYLON.Color3(0.2, 0.8, 0.2);
ground.material = gmat;

// Player
const player = BABYLON.MeshBuilder.CreateBox("p", {size:1}, scene);
player.position.y = 0.5;
const pmat = new BABYLON.StandardMaterial("pmat", scene);
pmat.diffuseColor = new BABYLON.Color3(0.8, 0.2, 0.2);
player.material = pmat;

// Physics
let velY = 0;
let onGround = true;

let move = { f:0, b:0, l:0, r:0 };

function bind(id, key) {
    const b = document.getElementById(id);
    b.ontouchstart = () => move[key] = 1;
    b.ontouchend = () => move[key] = 0;
}

bind("up","f");
bind("down","b");
bind("left","l");
bind("right","r");

document.getElementById("jump").ontouchstart = () => {
    if (onGround) {
        velY = 0.22;
        onGround = false;
    }
};

scene.onBeforeRenderObservable.add(() => {
    const speed = 0.08;

    if (move.f) player.position.z += speed;
    if (move.b) player.position.z -= speed;
    if (move.l) player.position.x -= speed;
    if (move.r) player.position.x += speed;

    // gravity
    velY -= 0.012;
    player.position.y += velY;

    if (player.position.y < 0.5) {
        player.position.y = 0.5;
        velY = 0;
        onGround = true;
    }

    // camera follow
    camera.position.x = player.position.x;
    camera.position.z = player.position.z - 10;
});

engine.runRenderLoop(() => scene.render());
window.addEventListener("resize", () => engine.resize());
</script>

</body>
</html>
